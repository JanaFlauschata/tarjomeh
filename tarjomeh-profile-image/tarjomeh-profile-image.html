<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">

<link rel="import" href="../tarjomeh-store/tarjomeh-store.html">
<link rel="import" href="../app-theme.html">

<dom-module id="tarjomeh-profile-image">

    <template>

        <style>

        </style>

            <paper-input label="upload a file!" type="file" accept="image/*" on-change="_uploadImage" always-float-label>
            </paper-input>
            <iron-image src="{{imageSrc}}"></iron-image>

    </template>

    <script>
        Polymer({
            is: "tarjomeh-profile-image",
            properties: {
                user: {
                    type: Array,
                    value: function () {
                        return [];
                    },
                    notify: true,
                }
            },

            // upload file
            _handleFile: function (file) {
                return function (event) {
                    var dataUrl = event.target.result;
                    hoodie.imagine.add('profile', dataUrl)
                            .progress(function (image) {
                                // image id and resized image is ready
                                // image properties: id, dataUrl, width, height, canvas

                                // show preview image
                                this.imageSrc = image.dataUrl;
                            }.bind(this))
                            .done(function (image) {
                                // image has been saved on the server
                                console.log(image.url('detail'));
                                console.log(image.url('avatar'));
                                console.log(image);
                                this.imageSrc = window.location.href + image.url('avatar');
                            }.bind(this))
                            .fail(function (error) {
                                console.error('the image could not be saved');
                                console.error(error);
                            });
                }.bind(this);
            },

            _uploadImage: function (event) {
                event.preventDefault();

                var files = event.target.files,
                        i, file;


                for (i = 0; (file = files[i]); i++) {

                    if (!file.type.match('image.*')) {
                        continue;
                    }

                    var reader = new FileReader();
                    reader.onload = this._handleFile(file);
                    reader.readAsDataURL(file);
                }
            }
        });
    </script>

</dom-module>