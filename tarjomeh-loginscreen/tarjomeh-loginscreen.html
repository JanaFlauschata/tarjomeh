<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../app-theme.html">
<link rel="import" href="../tarjomeh-auth/tarjomeh-auth.html">

<dom-module id="tarjomeh-loginscreen">

  <template>

    <style>
      :host {
   
      }
    
      paper-card {
        max-width: 500px;
        margin-bottom: 16px;
      };
      
      paper-input {
        width: 80%;
      };
    </style>
    
    <div>
      <paper-card image="resources/welcome.png">
        <div class="card-actions">
          <iron-icon src="../resources/g-logo.png"></iron-icon>
          <paper-button on-tap="_loginGoogle">Login with Google</paper-button>
        </div>
        <div class="card-actions">
          <div id="loginPassword" class="layout horizontal center center-justified">
            <div class="flex">
              <paper-input label="Type your email address..." value="{{email}}"></paper-input>
              <paper-input label="Type your password..."  value="{{password}}" type="password"></paper-input>
            </div>
            <paper-fab icon="forward" id="sendButton" on-tap="_loginPassword"></paper-fab>
          </div>
          <div id="loginPasswordButton">
            <iron-icon icon="account-box"></iron-icon>
            <paper-button on-tap="_showLoginPassword">Login with email</paper-button>
          </div>
        </div>
        <div class="card-actions">
          <div id="createAccount" class="layout horizontal center center-justified">
            <div class="flex">
              <paper-input id="emailCreateInput" label="Type your email address..." value="{{emailCreate}}"></paper-input>
              <paper-input label="Choose a password..."  value="{{passwordCreate}}" type="password"></paper-input>
            </div>
            <paper-fab icon="send" id="sendButton" on-tap="_createUser"></paper-fab>
          </div>
          <div id="createAccountButton">
            <iron-icon icon="create"></iron-icon>
            <paper-button on-tap="_showCreateAccount">Create account</paper-button>
          </div>
        </div>
      </paper-card>
    </div>
  </template>

  <script>
    Polymer({
      is: "tarjomeh-loginscreen",
      properties: {
        provider: {
          type: String,
          value: 'password',
          notify: true
        },
        params: {
          type: Object,
          value: function(){
            return {};
          },
          notify: true
        }
      },
      
      ready: function() {
        this.$.createAccount.hidden = true;
        this.$.loginPassword.hidden = true;
      },
      
      _showCreateAccount() {
        this.$.createAccount.hidden = false;
        this.$.createAccountButton.hidden = true;
        this.$.loginPassword.hidden = true;
        this.$.loginPasswordButton.hidden = false;
        this._resetInputs();
      },
      
      _showLoginPassword() {
        this.$.loginPassword.hidden = false;
        this.$.loginPasswordButton.hidden = true;
        this.$.createAccount.hidden = true;
        this.$.createAccountButton.hidden = false;
        this._resetInputs();
      },
      
      _loginGoogle() {
        this.$.createAccount.hidden = true;
        this.$.createAccountButton.hidden = false;
        this.$.loginPassword.hidden = true;
        this.$.loginPasswordButton.hidden = false;
        this._resetInputs();
        this.provider = "google";
        this.fire('login-requested', {});
      },
      
      _loginPassword: function() {
        this.params = { "email": this.email, "password": this.password};
        this.email = "";
        this.password = "";
        this.provider = "password";
        this.fire('login-requested', {});
      },
      
      _createUser: function() {
        this.fire('create-user-requested', {emailCreate: this.emailCreate, passwordCreate: this.passwordCreate});
        this._resetInputs();
      },
      
      _resetInputs: function() {
        this.email = "";
        this.password = "";
        this.emailCreate = "";
        this.passwordCreate = "";
      }
      
    });
  </script>

</dom-module>