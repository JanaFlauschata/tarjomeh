<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/firebase-element/firebase.html">
<link rel="import" href="../bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="../tarjomeh-collection/tarjomeh-collection.html">

<dom-module id="tarjomeh-auth">

  <template>

    <style>
    </style>
    
    <firebase-auth id="fbAuth" user="{{fbUser}}" location="https://radiant-inferno-3701.firebaseio.com" provider={{provider}} params={{params}} on-error="_errorHandler" redirect></firebase-auth>

  </template>

  <script>
    Polymer({
      is: "tarjomeh-auth",
      listeners: {
        "login": "_processLogin",
        "logout": "_processLogout",
        "user-created": "_processCreatedUser"
      },
      properties: {
        fbUser: {
          type: Object,
          value: function(){
            return {};
          },
          notify: true
        },
        errorMessage: {
          type: String,
          value: "",
          notify: true
        }
      },
      
      login : function(provider, params) {
        this.provider = provider;
        this.$.fbAuth.login(params);
      },
  
      logout : function() {
        this.$.fbAuth.logout();
      },
      
      createUser : function(email, password) {
        this.$.fbAuth.createUser(email, password);
      },
      
      _processLogin : function(event) {
        console.log('login succeeded!');

      },
      
       _processLogout : function(event) {
         //TODO last_active won't be set correctly on logout
        console.log('logout succeeded!');
      },
      
       _processCreatedUser : function(event) {
        console.log('user created!');
      },
      
       _errorHandler : function(event) {
        this.errorMessage = event.detail.message;
        console.log(this.errorMessage);
      }
    });
  </script>

</dom-module>