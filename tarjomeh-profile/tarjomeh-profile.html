<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../tarjomeh-collection/tarjomeh-collection.html">

<dom-module id="tarjomeh-profile">

    <template>
        <style></style>
    </template>

    <script>
        Polymer({
            is: "tarjomeh-profile",
            properties: {
                uid: {
                    type: String,
                    value: function() {
                        return hoodie.id();
                    }
                },
                profile: {
                    type: Object,
                    value: function () {
                        return {};
                    },
                    notify: true
                }
            },

            ready: function () {

                if (this.uid === hoodie.id()) {
                    hoodie.store.findOrAdd('profile', hoodie.id(), {name: hoodie.account.username})
                            .publish()
                            .done(function (profile) {
                                this.profile = profile;
                                //TODO implement
//                                this.profile.last_logout = this.profile.last_active;
//                                this.profile.last_login = Firebase.ServerValue.TIMESTAMP;
//                                this.$.profileCollection.addToChild('profile', this.profile);
                            })
                            .fail(function (error) {
                                console.error('profile could not be found or created');
                                console.error(error);
                            });
                }
                else {
                    hoodie.global.find('profile', uid)
                            .done(function (profile) {
                                this.profile = profile;
                                //TODO listen to changes
                            })
                            .fail(function (error) {
                                console.error('profile for user ' + uid + ' could not be found');
                                console.error(error);
                            });
                }

            }

        });
    </script>

</dom-module>