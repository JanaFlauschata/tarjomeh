<!doctype html>

<html>
<head>
  <title>Tarjomeh</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>

  <link rel="import" href="bower_components/paper-input/paper-input.html">
  <link rel="import" href="bower_components/paper-fab/paper-fab.html">
  
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
  <link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
  <link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
  <link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
  <link rel="import" href="bower_components/paper-button/paper-button.html">
  <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="bower_components/iron-icon/iron-icon.html">
  <link rel="import" href="bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="bower_components/iron-pages/iron-pages.html">
  
    <link rel="import" href="tarjomeh-auth/tarjomeh-auth.html">
 <link rel="import" href="tarjomeh-collection/tarjomeh-collection.html">

  <link rel="stylesheet" href="styles.css">
</head>

<body fullbleed unresolved>
<template id="t" is="dom-bind">
      
      <tarjomeh-collection id="dataConnection"
 path="messages"
  data="{{messages}}"></tarjomeh-collection>

  <paper-drawer-panel>
    <paper-header-panel drawer>
     <!-- <paper-toolbar>Menu</paper-toolbar>-->
      <div> Drawer content... </div>
    </paper-header-panel>
    <paper-header-panel main>
      <paper-toolbar class="medium-tall">
        <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
        <div class="title">Tarjomeh</div>
        <iron-icon icon="account-circle"></iron-icon>
        
        <div class="bottom fit" horizontal layout>
        <paper-tabs selected="{{selected}}">
          <paper-tab>Login</paper-tab>
          <paper-tab>Chat</paper-tab>
        </paper-tabs>
        </div>
        
      </paper-toolbar>
      <iron-pages selected="{{selected}}">
        <div>
         <tarjomeh-auth id="auth" user="{{user}}" status-known="{{statusKnown}}" provider="google"></tarjomeh-auth>
         <div hidden={{!loggedIn(user)}}>
          <paper-button raised on-tap="logout">Logout</paper-button>
          </div>
          <div hidden={{loggedIn(user)}}>
          <paper-button raised on-tap="login">Login</paper-button>
          </div>
        </div>
        
        <div>
         <div hidden={{!loggedIn(user)}}>
          <template is="dom-repeat" items="[[messages]]" as="message">
            <div class="layout horizontal" style="padding: 16px">
             <div class="avatar" style$="[[computeImgStyle(message.img)]]"></div>
              <div flex>
              <div>[[message.name]]</div>
              <div>[[message.text]]</div>
              </div>
            </div>
        </template>
           <div class="send-message layout horizontal">
              <paper-input flex label="Type message..." id="input" value="{{input}}"></paper-input>
              <paper-fab icon="send" id="sendButton" on-tap="sendMessage"></paper-fab>
            </div>
        </div>
        <div hidden={{loggedIn(user)}}>
          Not logged in.
        </div>
        </div>
      </iron-pages>
    </paper-header-panel>
  </paper-drawer-panel>
</template>
</body>
<script>

 var template = document.querySelector('#t');
 var dataConnection = document.querySelector('#dataConnection');
 var auth = document.querySelector('#auth');

 document.addEventListener('WebComponentsReady', function () {
    template.selected = 0;
    template.input = '';
    dataConnection = document.querySelector('#dataConnection');
    auth = document.querySelector('#auth');
  });
    
  template.sendMessage = function (e) {
    if(!template.input) return;
    dataConnection.add({'uid':template.user.uid,'name':template.user.google.displayName,'img':template.user.google.profileImageURL,'text':template.input});
    template.input = '';
  };
  
 
  template.login = function() {
    auth.login();
  };

  template.logout = function() {
    auth.logout();
  };
  
  template.loggedIn = function(user) {
      return user !== null && user != undefined;
    };
    
    template.computeImgStyle = function(imageUrl) {
        return 'background-image: url(' + imageUrl + ')';
      };
  
</script>
</html>
